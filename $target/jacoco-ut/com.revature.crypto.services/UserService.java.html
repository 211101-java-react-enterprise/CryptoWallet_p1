<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UserService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">cryptoWallet-webApp-P1</a> &gt; <a href="index.source.html" class="el_package">com.revature.crypto.services</a> &gt; <span class="el_source">UserService.java</span></div><h1>UserService.java</h1><pre class="source lang-java linenums">package com.revature.crypto.services;

import com.revature.CryptoORM_P1.exception.InvalidClassException;
import com.revature.CryptoORM_P1.exception.MethodInvocationException;
import com.revature.CryptoORM_P1.mapper.SQLMapper;
import com.revature.crypto.daos.UserDAO;
import com.revature.crypto.exceptions.AuthenticationException;
import com.revature.crypto.exceptions.InvalidRequestException;
import com.revature.crypto.models.User;

import java.sql.SQLException;
import java.util.UUID;

/**
 * User Service class holds logic surrounding the validity of
 * user entered information and ensures database integrity.
 *
 */
public class UserService {

    UserDAO userDAO;

<span class="fc" id="L23">    public UserService(UserDAO userDAO){</span>
<span class="fc" id="L24">        this.userDAO = userDAO;</span>
<span class="fc" id="L25">    }</span>

    public boolean registerNewUser(User newUser) throws InvalidClassException, MethodInvocationException, SQLException, InvalidRequestException  {
<span class="nc bnc" id="L28" title="All 2 branches missed.">        if (!isUserValid(newUser)) {</span>
<span class="nc" id="L29">            throw new InvalidRequestException(&quot;Invalid user data provided!&quot;);</span>
        }

<span class="nc bnc" id="L32" title="All 2 branches missed.">        if (userDAO.findUserByUsername(newUser) != null)  {</span>
<span class="nc" id="L33">            throw new InvalidRequestException(&quot;Username is already taken!&quot;);</span>
        }

        //give User UUID
<span class="nc" id="L37">        newUser.setUserId(UUID.randomUUID().toString());</span>

<span class="nc bnc" id="L39" title="All 2 branches missed.">        if(!userDAO.save(newUser)) {</span>
<span class="nc" id="L40">            throw new InvalidRequestException(&quot;The user could not be persisted to database for some reason&quot;);</span>
        }
<span class="nc" id="L42">        return true;</span>
    }

    public boolean deleteUser(User deleteUser) throws InvalidClassException, MethodInvocationException, SQLException {
<span class="nc bnc" id="L46" title="All 2 branches missed.">        if (userDAO.removeById(deleteUser)) {</span>
<span class="nc" id="L47">            return true;</span>
        }
<span class="nc" id="L49">        return false;</span>
    }
    /**
     *      UserService#isUserValid is used to check if a user has
     *      provided valid information before persisting to database.
     *
     *      Paramaters: newUser of type User (a new user that is trying to
     *                  be added to the database
     *      Returns:    boolean - true is a valid user ready to be stored
     *                            to the database and false is a user that
     *                            should not be persisted to database
     */
    public boolean isUserValid(User sessionUser) {
<span class="pc bpc" id="L62" title="1 of 2 branches missed.">        if (sessionUser == null) return false;</span>
<span class="pc bpc" id="L63" title="2 of 4 branches missed.">        if (sessionUser.getFirstName() == null || sessionUser.getFirstName().trim().equals(&quot;&quot;)) return false;</span>
<span class="pc bpc" id="L64" title="2 of 4 branches missed.">        if (sessionUser.getLastName() == null || sessionUser.getLastName().trim().equals(&quot;&quot;)) return false;</span>
<span class="pc bpc" id="L65" title="2 of 4 branches missed.">        if (sessionUser.getUsername() == null || sessionUser.getUsername().trim().equals(&quot;&quot;)) return false;</span>
<span class="pc bpc" id="L66" title="2 of 4 branches missed.">        return sessionUser.getPassword() != null &amp;&amp; !sessionUser.getPassword().trim().equals(&quot;&quot;);</span>
    }

    /**
     * calls methods important to authenticating the integrity of the data and then persists
     */
    public User authenticateUser(User sessionUser) throws InvalidClassException, MethodInvocationException, SQLException, InvalidRequestException, AuthenticationException {

<span class="nc bnc" id="L74" title="All 2 branches missed.">        if (!isUserAuthentic(sessionUser)) {</span>
<span class="nc" id="L75">            throw new InvalidRequestException(&quot;Invalid credential values provided!&quot;);</span>
        }

<span class="nc" id="L78">        User authenticatedUser = userDAO.findUserByUsernameAndPassword(sessionUser);</span>

<span class="nc bnc" id="L80" title="All 2 branches missed.">        if (authenticatedUser == null) {</span>
<span class="nc" id="L81">            throw new AuthenticationException();</span>
        }

<span class="nc" id="L84">        return authenticatedUser;</span>

    }

    /**
     *validates username and password
     */
    public boolean isUserAuthentic(User sessionUser){
<span class="nc bnc" id="L92" title="All 4 branches missed.">        if (sessionUser.getUsername() == null || sessionUser.getUsername().trim().equals(&quot;&quot;)) return false;</span>
<span class="nc bnc" id="L93" title="All 4 branches missed.">        return sessionUser.getPassword() != null &amp;&amp; !sessionUser.getPassword().trim().equals(&quot;&quot;);</span>
    }

    public boolean updateUser(User updatedUser) throws InvalidClassException, MethodInvocationException, SQLException {
<span class="nc" id="L97">        return userDAO.update(updatedUser);</span>
    }


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>